.section.process
  .row
    .col-md-12
      %h2.project-name= @project.name
      = link_to project_path, class: 'show-project-link', 'data-toggle': 'modal', 'data-target': '#modal' do
        %span.glyphicon.glyphicon-eye-open{ data: {toggle: 'tooltip', placement: 'top'}, title: 'View'}
      = link_to project_path, class: 'print-project-link' do
        %span.glyphicon.glyphicon-print{ data: {toggle: 'tooltip', placement: 'top'}, title: 'Print'}
    .col-md-12
    %small
      %em.text-muted
        .col-md-12= "Started on #{@project.created_at.strftime('%m/%d/%Y')}"
  - unless @response_nodes.length.zero?
    .row.spacer
      .col-md-12.previous-container
      .col-md-12
        %h4.panel-title Previous Questions
      .col-md-12
        %small
          %em.text-muted Click to see a previous question and your response.
      .col-md-12.spacer
        %div{ class: 'btn-group', role: 'group' }
          - @response_nodes.each do |n|
            = link_to n.index, previous_project_path(node_code: n.question_code), { class: "#{n.question.kind == 'd' ? 'btn btn-info' : 'btn btn-default'}", title: "Question #{n.index}: #{n.question.kind == 'd' ? n.question.summary : n.question.content}" }
  .node.spacer
    .col-md-6.question-container
      .col-md-12
        - if current_user.admin?
          = link_to edit_question_path(@next_node.question), class: 'edit-question-link', 'data-toggle': 'modal', 'data-target': '#modal' do
            %span.glyphicon.glyphicon-edit{ data: {toggle: 'tooltip', placement: 'top'}, title: 'Edit question'}
        - if @next_node.question.kind == 'q'
          %h4= "Question #{@index}"
      - if current_user.admin?
        .col-md-12
          = "Node #{@next_node.question_code}"
      .col-md-12
        - if @next_node.question.kind == 'q'
          %h4.content= @next_node.question.content
        - if @next_node.question.kind == 'd'
          .panel.panel-info
            .panel-heading
              %h4 Decision
            .panel-body
              = @next_node.question.content
        - if @next_node.question.kind == 'r'
          .panel.panel-success
            .panel-heading
              %h4 Accounting Recommendation
            .panel-body
              = @next_node.question.content
        - if @next_node.question.kind == 'i'
          %h5.content= @next_node.question.content
      = form_for @project, url: { action: 'work' }, method: 'get', html: { id: 'node' } do |f|
        %input{ type: 'hidden', name: 'question_id', id: 'question_id', value: @next_node.question_id }
        %input{ type: 'hidden', name: 'node_id', id: 'node_id', value: @next_node.id }
        %input{ type: 'hidden', name: 'index', id: 'index', value: @index }
        %input{ type: 'hidden', name: 'response_value', id: 'response_value', value: '' }
        %input{ type: 'hidden', name: 'target_node', id: 'target_node', value: '' }
        %input{ type: 'hidden', name: 'return_node', id: 'return_node', value: '' }
        - if %w[q r].include?@next_node.question.kind
          .col-md-12.spacer
            %textarea{ rows: '4', name: 'comment', id: 'comment', placeholder: 'Enter comments related to this question here. Your comments will appear in the printed report', style: 'min-width: 100%', onclick: "$(this).wysihtml5({'toolbar':{'font-styles':false,'color':false,'image':false,'link':false,'emphasis':{'small':false},'size':'xs'}});", class: 'form-controls wysihtml5' }
        .col-md-12
          - if @next_node.response_1.present?
            = f.submit @next_node.response_1, { class: 'btn btn-default node-response', onclick: "$('#response_value').val('1');$('#target_node').val('#{@next_node.target_1}');$('#return_node').val('#{@next_node.return_node}')" }
          - if @next_node.response_2.present?
            = f.submit @next_node.response_2, { class: 'btn btn-default node-response', onclick: "$('#response_value').val('2');$('#target_node').val('#{@next_node.target_2}');$('#return_node').val('#{@next_node.return_node}')" }
          - if @next_node.response_3.present?
            = f.submit @next_node.response_3, { class: 'btn btn-default node-response', onclick: "$('#response_value').val('3');$('#target_node').val('#{@next_node.target_3}');$('#return_node').val('#{@next_node.return_node}')" }
    .col-md-6.info-container
      - if @next_node.question.kind != 'i'
        - if @next_node.question.has_contents? || @next_node.question.has_summary?
          .info-buttons
            %ul.nav.nav-tabs{ id: 'infotabs', role: 'tablist' }
              - if @next_node.question.summary.present?
                %li{ role: 'presentation', class: 'active' }
                  %a{ href: '#summary', id: 'summary-tab', role: 'tab', 'data-toggle': 'tab', 'aria-controls': 'summary' } Summary 
              - if @next_node.question.help.present?
                %li{ role: 'presentation' }
                  %a{ href: '#help', id: 'help-tab', role: 'tab', 'data-toggle': 'tab', 'aria-controls': 'help' } Help
              - if @next_node.question.examples.present?
                %li{ role: 'presentation' }
                  %a{ href: '#examples', id: 'examples-tab', role: 'tab', 'data-toggle': 'tab', 'aria-controls': 'examples' } Examples
              - if @next_node.question.faq.present?
                %li{ role: 'presentation' }
                  %a{ href: '#faq', id: 'faq-tab', role: 'tab', 'data-toggle': 'tab', 'aria-controls': 'faq' } FAQ
              - if @next_node.question.asc.present?
                %li{ role: 'presentation' }
                  %a{ href: '#asc', id: 'asc-tab', role: 'tab', 'data-toggle': 'tab', 'aria-controls': 'asc' } ASC
      - else
        - if @next_node.question.has_contents?
          .info-buttons
            %ul.nav.nav-tabs{ id: 'infotabs', role: 'tablist' }
              - if @next_node.question.help.present?
                %li{ role: 'presentation', class: 'active' }
                  %a{ href: '#help', id: 'help-tab', role: 'tab', 'data-toggle': 'tab', 'aria-controls': 'help' } Help
              - if @next_node.question.examples.present?
                %li{ role: 'presentation' }
                  %a{ href: '#examples', id: 'examples-tab', role: 'tab', 'data-toggle': 'tab', 'aria-controls': 'examples' } Examples
              - if @next_node.question.faq.present?
                %li{ role: 'presentation' }
                  %a{ href: '#faq', id: 'faq-tab', role: 'tab', 'data-toggle': 'tab', 'aria-controls': 'faq' } FAQ
              - if @next_node.question.asc.present?
                %li{ role: 'presentation' }
                  %a{ href: '#asc', id: 'asc-tab', role: 'tab', 'data-toggle': 'tab', 'aria-controls': 'asc' } ASC
      - if @next_node.question.kind != 'i'
        - if @next_node.question.has_contents? || @next_node.question.has_summary?
          .tab-content
            - if @next_node.question.summary.present?
              .tab-pane{ id: 'summary', class: 'active', role: 'tabpanel' }
                = simple_format(@next_node.question.summary)
            - if @next_node.question.help.present?
              .tab-pane{ id: 'help', role: 'tabpanel' }
                = simple_format(@next_node.question.help)
            - if @next_node.question.examples.present?
              .tab-pane{ id: 'examples', role: 'tabpanel' }
                = simple_format(@next_node.question.examples)
            - if @next_node.question.faq.present?
              .tab-pane{ id: 'faq', role: 'tabpanel' }
                = simple_format(@next_node.question.faq)
            - if @next_node.question.asc.present?
              .tab-pane{ id: 'asc', role: 'tabpanel' }
                = simple_format(@next_node.question.asc)
      - else
        - if @next_node.question.has_contents?
          .tab-content
            - if @next_node.question.help.present?
              .tab-pane{ id: 'help', role: 'tabpanel', class: 'active' }
                = simple_format(@next_node.question.help)
            - if @next_node.question.examples.present?
              .tab-pane{ id: 'examples', role: 'tabpanel' }
                = simple_format(@next_node.question.examples)
            - if @next_node.question.faq.present?
              .tab-pane{ id: 'faq', role: 'tabpanel' }
                = simple_format(@next_node.question.faq)
            - if @next_node.question.asc.present?
              .tab-pane{ id: 'asc', role: 'tabpanel' }
                = simple_format(@next_node.question.asc)
