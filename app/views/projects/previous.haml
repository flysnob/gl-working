.section.process
  .row
    .col-md-12
      %h2= @project.name
      = link_to project_path, class: 'show-project-link', 'data-toggle': 'modal', 'data-target': '#modal' do
        %span.glyphicon.glyphicon-eye-open{ data: {toggle: 'tooltip', placement: 'top'}, title: 'View'}
      = link_to project_path, class: 'print-project-link' do
        %span.glyphicon.glyphicon-print{ data: {toggle: 'tooltip', placement: 'top'}, title: 'Print'}
    .col-md-12
    %small
      %em.text-muted
        .col-md-12= "Started on #{@project.created_at.strftime('%m/%d/%Y')}"
  - unless @response_nodes.length.zero?
    .row.spacer
      .col-md-12
        %h4.panel-title Previous Questions
      .col-md-12
        %small
          %em.text-muted Click on a node to see a previous question and your response.
      .col-md-12.spacer
        %div{ class: 'btn-group', role: 'group' }
          - @response_nodes.each do |n|
            = link_to n.index, previous_project_path(node_code: n.question_code), { class: "#{n.kind == 'd' ? 'btn btn-info' : 'btn btn-default'}", title: "Node question(ID #{n.question_code}): #{n.kind == 'd' ? n.summary : n.content}" }
    .row.spacer
      .col-md-12
        =link_to 'Return to Last Node', work_project_path, { class: 'btn btn-default' }
  .node.spacer
    .col-md-6.question-container
      .col-md-12
        - if current_user.admin?
          = link_to edit_question_path(@next_node.question), class: 'edit-question-link', 'data-toggle': 'modal', 'data-target': '#modal' do
            %span.glyphicon.glyphicon-edit{ data: {toggle: 'tooltip', placement: 'top'}, title: 'Edit question'}
        - if @next_node.question.kind == 'q'
          %h4= "Question #{@index}"
        - if @next_node.question.kind == 'r'
          %h4 Accounting Recommendation
        - if @next_node.question.kind == 'd'
          %h4 Decision
      - if current_user.admin?
        .col-md-12
          = "Node #{@next_node.question_code}"
      .col-md-12
        %h4= @next_node.question.content
      .col-md-12
        %div= simple_format(@next_node.question.summary, {}, wrapper_tag: 'div')
      = form_for @project, url: { action: 'work' }, method: 'get', html: { id: 'node' } do |f|
        %input{ type: 'hidden', name: 'question_id', id: 'question_id', value: @next_node.question_id }
        %input{ type: 'hidden', name: 'node_id', id: 'node_id', value: @next_node.id }
        %input{ type: 'hidden', name: 'index', id: 'index', value: @index }
        %input{ type: 'hidden', name: 'response_value', id: 'response_value', value: '' }
        %input{ type: 'hidden', name: 'target_node', id: 'target_node', value: '' }
        %input{ type: 'hidden', name: 'return_node', id: 'return_node', value: '' }
        - if @next_node.question.kind != 'd'
          .col-md-12.spacer
            %textarea{ rows: '4', name: 'comment', id: 'comment', placeholder: 'Enter comments related to this node here', style: 'min-width: 100%', value: @next_node.comment }
          .col-md-12
            - if @next_node.response_1.present?
              = f.submit @next_node.response_1, { class: "btn #{@next_node.response_text == @next_node.response_1 ? 'btn-primary' : 'btn-default'} node-response", onclick: "$('#response_value').val('1');$('#target_node').val('#{@next_node.target_1}');$('#return_node').val('#{@next_node.return_node}')" }
            - if @next_node.response_2.present?
              = f.submit @next_node.response_2, { class: "btn #{@next_node.response_text == @next_node.response_2 ? 'btn-primary' : 'btn-default'} node-response", onclick: "$('#response_value').val('2');$('#target_node').val('#{@next_node.target_2}');$('#return_node').val('#{@next_node.return_node}')" }
            - if @next_node.response_3.present?
              = f.submit @next_node.response_3, { class: "btn #{@next_node.response_text == @next_node.response_3 ? 'btn-primary' : 'btn-default'} node-response", onclick: "$('#response_value').val('3');$('#target_node').val('#{@next_node.target_3}');$('#return_node').val('#{@next_node.return_node}')" }
          .col-md-12
            = "You previously answered '#{@next_node.response_text}'"
    .col-md-6.info-container
      .info-buttons
        .btn-group
          %button{ id: 'asc', class: 'btn btn-success', onclick: "$('#info-container').html('#{simple_format(@next_node.question.asc)}').removeClass('hidden');" }
            ASC
          %button{ id: 'examples', class: 'btn btn-success', onclick: "$('#info-container').html('#{simple_format(@next_node.question.examples)}').removeClass('hidden');" }
            Examples
          %button{ id: 'faq', class: 'btn btn-success', onclick: "$('#info-container').html('#{simple_format(@next_node.question.faq)}').removeClass('hidden');" }
            FAQ
          %button{ id: 'help', class: 'btn btn-success', onclick: "$('#info-container').html('#{simple_format(@next_node.question.help)}').removeClass('hidden');" }
            Help
      .col-md-12#container.bg-info.hidden
